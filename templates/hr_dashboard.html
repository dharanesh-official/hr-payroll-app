{% extends "base.html" %}

{% block title %}HR Dashboard{% endblock %}

{% block content %}
  {% if announcements %}
  <div class="announcement-section">
      <h4>Company Announcements</h4>
      {% for announcement in announcements %}
          <div class="announcement-card">
              <p>{{ announcement.content }}</p>
              <small>Posted by {{ announcement.author.name }} on {{ announcement.timestamp.strftime('%d-%b-%Y') }}</small>
          </div>
      {% endfor %}
  </div>
  {% endif %}

  <h2>HR Administration Dashboard</h2>
  <div class="header-actions">
    <a href="{{ url_for('register') }}"><button>+ Register New User</button></a>
    <a href="{{ url_for('holidays') }}"><button>Manage Holidays</button></a>
    <a href="{{ url_for('manage_announcements') }}"><button>Post Announcements</button></a>
    <a href="{{ url_for('analytics_dashboard') }}"><button>View Analytics</button></a>
  </div>
  <div class="card">
    <div class="filter-container">
      <form method="GET" action="{{ url_for('dashboard') }}">
          <input type="text" name="search" placeholder="Search by Name or ID..." value="{{ request.args.get('search', '') }}">
          <select name="role">
              <option value="">All Roles</option>
              <option value="employee" {% if request.args.get('role') == 'employee' %}selected{% endif %}>Employee</option>
              <option value="supervisor" {% if request.args.get('role') == 'supervisor' %}selected{% endif %}>Supervisor</option>
              <option value="hr" {% if request.args.get('role') == 'hr' %}selected{% endif %}>HR</option>
          </select>
          <button type="submit">Filter</button>
      </form>
    </div>
    <h3>All Company Employees</h3>
    {% if all_employees %}
      <div class="table-responsive">
        <table>
          <thead> <tr> <th>Employee ID</th> <th>Name</th> <th>Role</th> <th>Supervisor</th> <th>Actions</th> </tr> </thead>
          <tbody>
            {% for employee in all_employees %}
              <tr>
                <td>{{ employee.employee_id }}</td>
                <td>{{ employee.name }}</td>
                <td>{{ employee.role | capitalize }}</td>
                <td>{{ employee.supervisor.name if employee.supervisor else '-' }}</td>
                <td class="actions">
                  <a href="{{ url_for('edit_user', user_id=employee.id) }}"><button class="small">Edit</button></a>
                  {% if employee.id != current_user.id %}
                    <form method="POST" action="{{ url_for('remove_user', user_id=employee.id) }}" onsubmit="return confirm('Are you sure you want to remove this user?');">
                      <button type="submit" class="small decline">Remove</button>
                    </form>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p>No employees found matching your criteria.</p>
    {% endif %}
  </div>
{% endblock %}